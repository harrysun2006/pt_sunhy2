var start=0;var end=0;function savePos(textBox){//如果是Firefox(1.5)的话，方法很简单if(typeof(textBox.selectionStart) == "number"){start = textBox.selectionStart;end = textBox.selectionEnd;}//下面是IE(6.0)的方法，麻烦得很，还要计算上'\n'else if(document.selection){var range = document.selection.createRange();if(range.parentElement().id == textBox.id){// create a selection of the whole textareavar range_all = document.body.createTextRange();range_all.moveToElementText(textBox);//两个range，一个是已经选择的text(range)，一个是整个textarea(range_all)//range_all.compareEndPoints()比较两个端点，如果range_all比range更往左(further to the left)，则 //返回小于0的值，则range_all往右移一点，直到两个range的start相同。// calculate selection start point by moving beginning of range_all to beginning of rangefor (start=0; range_all.compareEndPoints("StartToStart", range) < 0; start++)range_all.moveStart('character', 1);// get number of line breaks from textarea start to selection start and add them to start// 计算一下\nfor (var i = 0; i <= start; i ++){if (textBox.value.charAt(i) == '\n')start++;}// create a selection of the whole textareavar range_all = document.body.createTextRange();range_all.moveToElementText(textBox);// calculate selection end point by moving beginning of range_all to end of rangefor (end = 0; range_all.compareEndPoints('StartToEnd', range) < 0; end ++)range_all.moveStart('character', 1);// get number of line breaks from textarea start to selection end and add them to endfor (var i = 0; i <= end; i ++){if (textBox.value.charAt(i) == '\n')end ++;}}}} $(function(){
	$('#emailform').submit(function(){				content = $('#content').val();		if(content.length==0){			alert('请输入正文!');			return false;		}else if($('#type').val()=='8' && $('#poiid').val()==''){			alert('请输入POI ID!');			return false;		}else{			if(confirm('确定要发送邮件？')==false){				return false;			}else{							}		}			});			$('#type').change(function(){		$('#activity').hide();		$('#phone_os').hide();		$('#poi_id').hide();		$('#content').show();		$('#preview_ifa').hide();		if($(this).val()=='1'){			$('#content').val('激动人心的〖开开K.ai〗新功能预告：\nXXXXXXXXXXXXX\n听起来很不错吧？让我们一起期待！<a href="http://k.ai/kai">http://k.ai/kai</a>');		}else if($(this).val()=='2'){			$('#content').val('〖开开K.ai〗又有新功能上线了！\nXXXXXXXXXXXXX\n很酷，不是吗？！抢先体验！<a href="http://k.ai/kai">http://k.ai/kai</a>');		}else if($(this).val()=='3'){			$('#activity').show();			$('#content').val('〖开开K.ai〗又有新活动了！\nXXXXXXXXXXXXX\n很酷，不是吗？！\n详情查看官方博客<a href="http://k.ai/kai">http://k.ai/kai</a>');		}else if($(this).val()=='4'){			$('#content').val('很抱歉，\nXXXXXXXXXXXXX\n给您带来诸多不便，深表歉意，敬请谅解！');		}else if($(this).val()=='5'){			$('#content').val('下期兑奖时间：\n奖品预测：\n更多详情请至官博查看。<a href="http://k.ai/kai">http://k.ai/kai</a>\n\n寻宝获得目前只支持手机客户端，现在就去寻宝吧！下载〖开开K.ai〗手机客户端：<a href="http://k.ai/tools">http://k.ai/tools</a>');		}else if($(this).val()=='6'){			$('#content').val('新一期的兑奖活动开始了！\n本期兑奖时间：\n本期可兑宝物：\n更多详情请至官博查看。<a href="http://k.ai/kai">http://k.ai/kai</a>\n\n寻宝获得目前只支持手机客户端，现在就去寻宝吧！下载〖开开K.ai〗手机客户端：<a href="http://k.ai/tools">http://k.ai/tools</a>');		}else if($(this).val()=='7'){			$('#phone_os').show();			$('#content').val('〖开开K.ai〗发布新版本了！\n\n试用平台：\n版本号：\n重要更新：\n下载方式：\n\n更多详情请至官博查看。<a href="http://k.ai/kai">http://k.ai/kai</a>');		}else if($(this).val()=='8'){			$('#poi_id').show();			$('#content').val('告诉你个好消息哦，一般人我不告诉他~\n{POI}有最新的掌门优惠：\nXXXXXXXXXXXXX\n<a href="http://k.ai/poi?id={POI_ID}">http://k.ai/poi?id={POI_ID}</a>');		}else{			$('#content').val('');		}	});			$('#checkpoi').click(function(){		$('#poiname').val('');		if($('#poiid').val()==''){			alert('请输入POI ID');			return false;		}		poi_id = $.trim($('#poiid').val());				Better_Notify('请稍候');		$.post(BETTER_ADMIN_URL+'/email/checkpoi', {			'poiid':poi_id		}, function(json){			Better_Notify_clear();			if(json.result==1){				$('#poiname').val(json.message);				$('#poiname').show();			}else{				alert(json.message);			}					}, 'json');	});			$('#btn_photo').click(function(){		var photo_link = prompt("请输入图片地址", "http://k.ai/images/");		if(photo_link){			var tag_img = '<img src="'+photo_link+'" />';			//添加到textarea			var textBox = document.getElementById("content");			var pre = textBox.value.substr(0, start);			var post = textBox.value.substr(end);			textBox.value = pre + tag_img + post;		}	});			$('#btn_preview').click(function(){		text_val = Better_nl2br($('#content').val());		if($.browser.msie){			doc = $(document.frames["preview_ifa"].document);		}else{			doc = $(document.getElementById("preview_ifa").contentDocument);		}				doc.find('#container').empty().append(text_val);				$('#content').hide();		$('#preview_ifa').show();			});			$('#btn_edit').click(function(){		$('#content').show();		$('#preview_ifa').hide();	});	
});